{"slug":"python-cleaner","title":"åŸºäºpythonçš„ç”µè„‘æ¸…æ´ç¨‹åº","date":"2026-02-24","desc":"pythonåšçš„æ¸…æ´è½¯ä»¶","format":"md","tags":["python"],"content":"# ğŸ”¥ ç”¨Pythonæ‰“é€ Windowsç³»ç»Ÿåƒåœ¾æ¸…ç†å·¥å…·\n## å‰è¨€\næ—¥å¸¸ä½¿ç”¨Windowsç³»ç»Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¤§é‡ä¸´æ—¶æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€ç¼“å­˜æ–‡ä»¶ç­‰åƒåœ¾æ•°æ®ï¼Œä¸ä»…å ç”¨ç£ç›˜ç©ºé—´ï¼Œè¿˜å¯èƒ½å½±å“ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€‚æœ¬æ–‡å°†åˆ†äº«ä¸€ä¸ªçº¯Pythonç¼–å†™çš„ç³»ç»Ÿåƒåœ¾æ¸…ç†å·¥å…·ï¼Œæ— éœ€å®‰è£…ç¬¬ä¸‰æ–¹æ¸…ç†è½¯ä»¶ï¼Œä¸€é”®æ‰«æå¹¶æ¸…ç†å„ç±»åƒåœ¾æ–‡ä»¶ï¼Œè¿˜æ”¯æŒæ¸…ç†scoopã€pipç¼“å­˜åŠå›æ”¶ç«™ï¼Œè½»é‡åŒ–ä¸”é«˜æ•ˆã€‚\n\n## ğŸ“‹ å·¥å…·æ ¸å¿ƒåŠŸèƒ½\n1. æ‰«æå¹¶åˆ é™¤æŒ‡å®šåç¼€çš„åƒåœ¾æ–‡ä»¶ï¼ˆä¸´æ—¶æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½æ–‡ä»¶ç­‰ï¼‰\n2. æ¸…ç†%TEMP%ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶å¤¹\n3. æ¸…ç†scoopåŒ…ç®¡ç†å™¨ç¼“å­˜ã€pipç¼“å­˜\n4. æ¸…ç©ºç³»ç»Ÿå›æ”¶ç«™\n5. ç»Ÿè®¡åƒåœ¾æ–‡ä»¶æ•°é‡åŠå ç”¨ç©ºé—´å¤§å°\n\n## ğŸ› ï¸ å®Œæ•´ä»£ç å®ç°\n``` python\nimport os\nimport subprocess\nimport send2trash\n\n# å®šä¹‰éœ€è¦æ¸…ç†çš„æ–‡ä»¶åç¼€åŠå¯¹åº”è¯´æ˜\ndel_extension = {\n    '.tmp': 'ä¸´æ—¶æ–‡ä»¶',\n    '._mp': 'ä¸´æ—¶æ–‡ä»¶_mp',\n    '.log': 'æ—¥å¿—æ–‡ä»¶',\n    '.gid': 'ä¸´æ—¶å¸®åŠ©æ–‡ä»¶',\n    '.chk': 'ç£ç›˜æ£€æŸ¥æ–‡ä»¶',\n    '.old': 'ä¸´æ—¶å¤‡ä»½æ–‡ä»¶',\n    '.xlk': 'Excelå¤‡ä»½æ–‡ä»¶',\n    '.bak': 'ä¸´æ—¶å¤‡ä»½æ–‡ä»¶bak'\n}\n\n# ç”¨æˆ·ç›®å½•ä¸‹éœ€æ¸…ç†çš„æ–‡ä»¶å¤¹ï¼ˆæœ¬æ–‡ç¤ºä¾‹æœªå®ç°è¯¥éƒ¨åˆ†ï¼Œå¯æ‰©å±•ï¼‰\ndel_userprofile = ['cookies','recent', 'Temporary Internet Files', 'Temp']\n# ç³»ç»Ÿç›®å½•ä¸‹éœ€æ¸…ç†çš„æ–‡ä»¶å¤¹ï¼ˆæœ¬æ–‡ç¤ºä¾‹æœªå®ç°è¯¥éƒ¨åˆ†ï¼Œå¯æ‰©å±•ï¼‰\ndel_windir = ['prefetch', 'temp']\n\n# è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡è·¯å¾„\nSYS_DRIVE = os.environ['systemdrive'] + '\\\\'\nUSER_PROFILE = os.environ['userprofile']\nWIN_DIR = os.environ['windir']\nTEMP_DIR = os.environ.get('TEMP', '')\n\ndef del_dir_or_file(root):\n    \"\"\"\n    åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹é€šç”¨å‡½æ•°\n    :param root: æ–‡ä»¶/æ–‡ä»¶å¤¹è·¯å¾„\n    \"\"\"\n    try:\n        if os.path.isfile(root):\n            os.remove(root)\n            print(\"file\", root, \"removed\")\n        elif os.path.isdir(root):\n            os.rmdir(root)\n            print(\"dir\", root, \"removed\")\n    except WindowsError:\n        print(\"failure\", root, \"can't remove\")\n\ndef formatSize(b):\n    \"\"\"\n    å­—èŠ‚å•ä½è½¬æ¢ï¼ˆB -> KB/MB/GBï¼‰\n    :param b: åŸå§‹å­—èŠ‚æ•°\n    :return: æ ¼å¼åŒ–åçš„å¤§å°å­—ç¬¦ä¸²\n    \"\"\"\n    try:\n        kb = b // 1024\n    except:\n        print(\"ä¼ å…¥å­—èŠ‚æ ¼å¼ä¸å¯¹\")\n        return \"Error\"\n    if kb > 1024:\n        M = kb // 1024\n        if M > 1024:\n            G = M // 1024\n            return \"%dG\" % G\n        else:\n            return \"%dM\" % M\n    else:\n        return \"%dkb\" % kb\n\nclass DiskClean(object):\n    \"\"\"ç³»ç»Ÿåƒåœ¾æ¸…ç†æ ¸å¿ƒç±»\"\"\"\n    def __init__(self):\n        self.del_info = {}  # å­˜å‚¨å„ç±»å‹åƒåœ¾æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯\n        self.del_file_paths = []  # å­˜å‚¨å¾…åˆ é™¤æ–‡ä»¶è·¯å¾„\n        self.total_size = 0  # åƒåœ¾æ–‡ä»¶æ€»å¤§å°\n        # åˆå§‹åŒ–ç»Ÿè®¡å­—å…¸\n        for i, j in del_extension.items():\n            self.del_info[i] = dict(name=j, count=0, size=0)\n\n    def scanf(self):\n        \"\"\"æ‰«æç”¨æˆ·ç›®å½•ä¸‹æŒ‡å®šåç¼€çš„åƒåœ¾æ–‡ä»¶\"\"\"\n        for roots, dirs, files in os.walk(USER_PROFILE):\n            for files_item in files:\n                file_extension = os.path.splitext(files_item)[1]\n                if file_extension in self.del_info:\n                    file_full_path = os.path.join(roots, files_item)\n                    self.del_file_paths.append(file_full_path)\n                    self.del_info[file_extension]['count'] += 1\n                    file_size = os.path.getsize(file_full_path)\n                    self.del_info[file_extension]['size'] += file_size\n                    self.total_size += file_size\n\n    def show(self):\n        \"\"\"å±•ç¤ºæ‰«æç»“æœï¼ˆå„ç±»å‹æ–‡ä»¶æ•°é‡ã€å¤§å°ï¼‰\"\"\"\n        re = formatSize(self.total_size)\n        for i in self.del_info:\n            size_str = formatSize(self.del_info[i]['size'])\n            print(self.del_info[i][\"name\"], \"å…±è®¡\", self.del_info[i][\"count\"], \"ä¸ªï¼Œå¤§å°ä¸º\", size_str)\n        return re\n\n    def delete_files(self):\n        \"\"\"åˆ é™¤æ‰«æåˆ°çš„åƒåœ¾æ–‡ä»¶\"\"\"\n        for i in self.del_file_paths:\n            print(i)\n            del_dir_or_file(i)\n\n    def run_external_commands(self):\n        \"\"\"æ‰§è¡Œå¤–éƒ¨æ¸…ç†å‘½ä»¤+æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤¹+æ¸…ç©ºå›æ”¶ç«™\"\"\"\n        try:\n            # æ¸…ç†scoopç¼“å­˜\n            subprocess.run(['scoop', 'cleanup', '*'], check=True)\n            print(\"scoop cleanup * æ‰§è¡ŒæˆåŠŸ\")\n            subprocess.run(['scoop', 'clean'], check=True)\n            print(\"scoop clean æ‰§è¡ŒæˆåŠŸ\")\n            subprocess.run(['scoop', 'cache', 'rm', '*'], check=True)\n            print(\"scoop cache rm * æ‰§è¡ŒæˆåŠŸ\")\n            # æ¸…ç†pipç¼“å­˜\n            subprocess.run(['pip', 'cache', 'purge'], check=True)\n            print(\"pip cache purge æ‰§è¡ŒæˆåŠŸ\")\n        except subprocess.CalledProcessError as e:\n            print(f\"æ‰§è¡Œå¤–éƒ¨å‘½ä»¤å‡ºé”™: {e}\")\n\n        # æ¸…ç©º%temp%æ–‡ä»¶å¤¹\n        if TEMP_DIR:\n            for root, dirs, files in os.walk(TEMP_DIR, topdown=False):\n                for file in files:\n                    file_path = os.path.join(root, file)\n                    try:\n                        os.unlink(file_path)\n                    except Exception as e:\n                        print(f\"åˆ é™¤æ–‡ä»¶ {file_path} å¤±è´¥: {e}\")\n                for dir in dirs:\n                    dir_path = os.path.join(root, dir)\n                    try:\n                        os.rmdir(dir_path)\n                    except Exception as e:\n                        print(f\"åˆ é™¤ç›®å½• {dir_path} å¤±è´¥: {e}\")\n            print(\"%temp%æ–‡ä»¶å¤¹æ¸…ç©ºæˆåŠŸ\")\n\n        # æ¸…ç†å›æ”¶ç«™\n        try:\n            send2trash.send2trash('C:\\\\$Recycle.Bin')\n            print(\"å›æ”¶ç«™æ¸…ç†æˆåŠŸ\")\n        except Exception as e:\n            print(f\"æ¸…ç†å›æ”¶ç«™å¤±è´¥: {e}\")\n\nif __name__ == \"__main__\":\n    print(\"åˆå§‹åŒ–æ¸…ç†åƒåœ¾ç¨‹åº\")\n    cleaner = DiskClean()\n    print(\"å¼€å§‹æ‰«æåƒåœ¾æ–‡ä»¶è¯·è€å¿ƒç­‰å¾…\\n\")\n    cleaner.scanf()\n    print(\"æ‰«ææˆåŠŸï¼Œç»“æœå¦‚ä¸‹\")\n    re = cleaner.show()\n    cleaner.delete_files()\n    cleaner.run_external_commands()\n'''"}